# What is data encryption? #

- encryption alters information, rendering plaintext data unreadable through mathematical algorithms and keys

## Symmetric Cryptographay ##
- a single ke is used to both encrypt and decrypt data

## Asymmetric Cryptographay ##
- involves 2 separate key: private key & public key
- one key is used to encrypt the data and the other key to decrypt the data

# When shoud data be encrypted? #
- any sensitive data at rest should be encrypted
- moving data should be done via a secure mechanism providing encryption in transit: HTTPS or SSL
- when encrpytion in transit is not possible, data should be encrypted prior to transmission

# Amazon S3 Encryption #
- S3 offers Server Side Encryption (SSE) and Customer Side Encryption (CSE)
- used for securing data at rest - data is encrypted at an object level before it is written to the physical disk
- an object encrypted with SSE is acessed as a normal operation as long as you have the required permissions

## Server Side Encryption ##

### SSE-S3 ###
- unique key to encrpyt the data object - key is encrypted with a Master Key
- objects are encrypted using AES-256
- symmmetric encryption

> bucket policies can enforce encryption enabled

### SSE-KMS ###
- uses KMS during encryption -> great flexibility of key management
- select default CMK or an existing CMK (Customer Master Key)

> KMS CMK is used to encrypt the data keys, not the object data itself

To encrypt the data a request is made by S3 to KMS, KMS returns 2 versions of a random generated data key:
- one version is plaintext and is used by S3 to encrypt the data
- the other version is encrypted and uploaded with the object

To decrypt the data in S3 sends the encrypted data key to KMS, KMS uses the CMK to decrypt the data key and responds with the plaintext key

> the plaintext key is stored in memory and deleted after encryption/decrypton

### SSE-C ###
- uses a customer provided Master Key 
- Amazon S3 uses the encryption key you provide to apply AES-256 encryption to the data
- symmetric encryption
- works only with HTTPS to secure the key -> secure data in transit

To encrypt the data the customer provides the Master Key with the data object over HTTPS -> S3 performs the encryption

To decrypt the data in S3 the customer needs to provide the Master Key with the request

> after encryption AWS deletes the key from memory and stores a HMAC value to validate future requests

## Client Side Encryption ##
- data is encrypted before is sent to S3
- uses S3 encryption client - example: java SDK client

### CSE-KMS ###
- only need to provide the CMK-ID to Amazon S3 - encryption managed by AWS

To upload data, a request is made by the client to KMS - KMS returns 2 versions of a random generated data key:
- one version is plaintext and is used by the client to encrypt the data
- the other version is a ciphered version of the data key and uploaded with the object metadata

To retrieve data, the object is downloaded in an encrypted form with the ciphered key
- the client sends the ciphered key to KMS in order to retrieve the matching plaintext version and decript the data

### CSE-C ###
- the key is never sent to AWS

To upload data, a Master Key needs to be provided to the client
- the master key will be used to encrypt a data key generated by the client, which will be used to encrypt the object data
- the client generated data key is encrypted with the Masterkey
- the encrypted data key is made part of the metadata object and uploaded to S3 with the encrypted data

To retrieve data, the object is downloaded in an encrypted form with the metadata
- the client Master Key is identified and used to decrypt the data key and in turn the data object

# Amazon Athena Encryption #
- serverless interactive query service which uses standard SQL and executes queries in parallel
- it can query S3 data that is already encrypted with SSE-S3, SSE-KMS or CSE-KMS

# Amazon Kinesis Encryption #

## Amazon Kinesis Firehose ##
- data can be send over HTTPS 
- data at rest is encrypted by default
- if S3 is used as a destination - Firehose can encrypted the data using SSE-KMS
- if Redshift is used a destination or Elasticsearch - data will first be stored in S3

## Amazon Kinesis Streams ##
- SSE encryption directly from producers
- consumers decrypt the data
- new datakey is generated every 5 min
- small latency when put/get object

# EMR Encryption #
- by default te instances within a cluster don't encrypt data at rest
- custom AMI can be used to encrypt root device volume

> EMR encryption with EBS: encrypt the volume

> EMR encryption with S3: all S3 encryption tools, encryption in transit with TLS


> EMR encryption with KMS: encryption of data at rest


# RDS Encryption #
- enable encryption at rest, storage, read replicas, back-ups
- encryption needs to selected when database is created or as an encrypted copy of a backup
- read replica follows the same encryption pattters as the main database
- encryption in transit using SSL/TLS

# Amazon Redshift Encryption #
- encryption at rest using a 4 tiered hierarchy: Master Key -> Cluster Encryption Key -> Database Encryption Key -> Data Encryption Key
- encryption of a cluster can happen only during  cluster creatin - it can't be disabled and vice versa
- key rotation is possible but the cluster is unavailable during this process

